function addItem(a,t,e){$.ajax({type:"POST",url:arNextOptions.SITE_DIR+"ajax/item_price.php",data:a,dataType:"json",success:function(s){getActualBasket(a.iblockID);BX.onCustomEvent("onCompleteAction",[{action:"loadForm"},t[0]]),arStatusBasketAspro={},null!==s?"STATUS"in s?(null===s.MESSAGE_EXT&&(s.MESSAGE_EXT=""),"OK"===s.STATUS?($(".to-cart[data-item="+e+"]").hide(),$(".to-cart[data-item="+e+"]").closest(".counter_wrapp").find(".counter_block").hide(),$(".to-cart[data-item="+e+"]").parents("tr").find(".counter_block_wr .counter_block").hide(),$(".to-cart[data-item="+e+"]").closest(".button_block").addClass("wide"),$(".in-cart[data-item="+e+"]").show(),addBasketCounter(e),$(".wish_item[data-item="+e+"]").removeClass("added"),$(".wish_item[data-item="+e+"]").find(".value").show(),$(".wish_item[data-item="+e+"]").find(".value.added").hide(),$("#ajax_basket").length&&reloadTopBasket("add",$("#ajax_basket"),200,5e3,"Y"),$("#basket_line .basket_fly").length&&(t.closest(".fast_view_frame").length||window.matchMedia("(max-width: 767px)").matches||$("#basket_line .basket_fly.loaded").length?basketFly("open","N"):basketFly("open"))):showBasketError(BX.message(s.MESSAGE)+" <br/>"+s.MESSAGE_EXT)):showBasketError(BX.message("CATALOG_PARTIAL_BASKET_PROPERTIES_ERROR")):($(".to-cart[data-item="+e+"]").hide(),$(".to-cart[data-item="+e+"]").closest(".counter_wrapp").find(".counter_block").hide(),$(".to-cart[data-item="+e+"]").parents("tr").find(".counter_block_wr .counter_block").hide(),$(".to-cart[data-item="+e+"]").closest(".button_block").addClass("wide"),$(".in-cart[data-item="+e+"]").show(),addBasketCounter(e),$(".wish_item[data-item="+e+"]").removeClass("added"),$(".wish_item[data-item="+e+"]").find(".value").show(),$(".wish_item[data-item="+e+"]").find(".value.added").hide(),$("#ajax_basket").length&&reloadTopBasket("add",$("#ajax_basket"),200,5e3,"Y"),$("#basket_line .basket_fly").length&&(t.closest(".fast_view_frame").length||window.matchMedia("(max-width: 767px)").matches||$("#basket_line .basket_fly.loaded").length?basketFly("open","N"):basketFly("open")))}})}function calculatePrice(){var a={price:0,old:0};return $(".set-composition_base .set-composition_row").each(function(t,e){a.price+=parseFloat($(e).data("price")),a.old+=parseFloat($(e).data("old-price"))}),a.base={price:a.price,old:a.old},$(".set-composition_accesories .set-composition_row").each(function(t,e){$(e).find(".set-composition_checkbox input").prop("checked")&&(a.price+=parseFloat($(e).data("price")),a.old+=parseFloat($(e).data("old-price")))}),a}function showPrice(a){var t='<div class="price_matrix_block"><div class="price_matrix_wrapper "><div class="price" data-currency="RUB" data-value="'+a.price+'"><span><span class="values_wrapper"><span class="price_value">'+formatNumber(a.price)+'</span><span class="price_currency"> руб.</span></span><span class="price_measure">/шт</span></span></div>';a.price<a.old&&(t+='<div class="price discount" data-currency="RUB" data-value="'+a.old+'"><span class="values_wrapper"><span class="price_value">'+formatNumber(a.old)+'</span><span class="price_currency"> руб.</span></span></div>',t+='<div class="sale_block"><span class="title">Экономия&nbsp;</span><div class="text"><span class="values_wrapper" data-currency="RUB" data-value="'+(a.old-a.price)+'"><span class="price_value">'+formatNumber(a.old-a.price)+'</span><span class="price_currency">&nbsp;руб.</span></span></div>'),t+="</div></div>",$(".prices_block .cost.prices").html(t)}function formatNumber(a){return a.toLocaleString("ru",{minimumFractionDigits:2}).replace(",",".").replace(" ","&nbsp;")}$(document).on("click",".to-cart:not(.read_more)",function(a){a.preventDefault();var t=$(this);if(!t.hasClass("clicked")){t.addClass("clicked");var e=$(this).attr("data-quantity"),s=$(this).data("props"),i="",o="",c="N",r={},d=$(this).data("iblockid"),n=$(this).data("offers"),p="",l="",_=$(this).attr("data-item");t.closest(".but-cell").length&&$('.counter_block[data-item="'+_+'"]').length&&(e=$('.counter_block[data-item="'+_+'"] input').val()),e||(e=1),"Y"!=n?n="N":l=$(this).closest(".prices_tab").find(".bx_sku_props input").val(),s&&(i=s.split(";")),$(this).data("part_props")&&(o=$(this).data("part_props")),$(this).data("add_props")&&(c=$(this).data("add_props")),$(".rid_item").length?p=$(".rid_item").data("rid"):$(this).data("rid")&&(p=$(this).data("rid")),r=fillBasketPropsExt(t,"prop",t.data("bakset_div"));var m=calculatePrice().base.price;if(m<=0&&(m=$(".prices_block .price:not(.discount)").data("value")),r.quantity=e,r.add_item="Y",r.rid=p,r.offers=n,r.iblockID=d,r.part_props=o,r.add_props=c,r.props=JSON.stringify(i),r.item=_,r.basket_props=l,r.price=m,"N"==t.data("empty_props")){showBasketError($("#"+t.data("bakset_div")).html(),BX.message("ERROR_BASKET_PROP_TITLE"),"Y",t);BX.onCustomEvent("onCompleteAction",[{action:"loadForm"},t[0]])}else addItem(r,t,_),$(".set-composition_accesories .set-composition_row").each(function(a,e){$(e).find(".set-composition_checkbox input").prop("checked")&&(r.item=$(e).data("id"),r.price=$(e).data("price"),addItem(r,t,_))})}}),$(function(){$(".set-composition .set-composition_checkbox input").change(function(a){var t=calculatePrice();t.price>0&&showPrice(t)})});