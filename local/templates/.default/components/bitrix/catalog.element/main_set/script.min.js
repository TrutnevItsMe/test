function addItem(t,e,s){$.ajax({type:"POST",url:arNextOptions.SITE_DIR+"ajax/item_price.php",data:t,dataType:"json",success:function(a){getActualBasket(t.iblockID);BX.onCustomEvent("onCompleteAction",[{action:"loadForm"},e[0]]),arStatusBasketAspro={},null!==a?"STATUS"in a?(null===a.MESSAGE_EXT&&(a.MESSAGE_EXT=""),"OK"===a.STATUS?($(".to-cart[data-item="+s+"]").hide(),$(".to-cart[data-item="+s+"]").closest(".counter_wrapp").find(".counter_block").hide(),$(".to-cart[data-item="+s+"]").parents("tr").find(".counter_block_wr .counter_block").hide(),$(".to-cart[data-item="+s+"]").closest(".button_block").addClass("wide"),$(".in-cart[data-item="+s+"]").show(),addBasketCounter(s),$(".wish_item[data-item="+s+"]").removeClass("added"),$(".wish_item[data-item="+s+"]").find(".value").show(),$(".wish_item[data-item="+s+"]").find(".value.added").hide(),$("#ajax_basket").length&&reloadTopBasket("add",$("#ajax_basket"),200,5e3,"Y"),$("#basket_line .basket_fly").length&&(e.closest(".fast_view_frame").length||window.matchMedia("(max-width: 767px)").matches||$("#basket_line .basket_fly.loaded").length?basketFly("open","N"):basketFly("open"))):showBasketError(BX.message(a.MESSAGE)+" <br/>"+a.MESSAGE_EXT)):showBasketError(BX.message("CATALOG_PARTIAL_BASKET_PROPERTIES_ERROR")):($(".to-cart[data-item="+s+"]").hide(),$(".to-cart[data-item="+s+"]").closest(".counter_wrapp").find(".counter_block").hide(),$(".to-cart[data-item="+s+"]").parents("tr").find(".counter_block_wr .counter_block").hide(),$(".to-cart[data-item="+s+"]").closest(".button_block").addClass("wide"),$(".in-cart[data-item="+s+"]").show(),addBasketCounter(s),$(".wish_item[data-item="+s+"]").removeClass("added"),$(".wish_item[data-item="+s+"]").find(".value").show(),$(".wish_item[data-item="+s+"]").find(".value.added").hide(),$("#ajax_basket").length&&reloadTopBasket("add",$("#ajax_basket"),200,5e3,"Y"),$("#basket_line .basket_fly").length&&(e.closest(".fast_view_frame").length||window.matchMedia("(max-width: 767px)").matches||$("#basket_line .basket_fly.loaded").length?basketFly("open","N"):basketFly("open")))}})}function calculatePrice(){var e={price:0,old:0};return $(".set-composition_base .set-composition_row").each(function(a,t){e.price+=parseFloat($(t).data("price"))*parseInt($(t).data("amount")),e.old+=parseFloat($(t).data("old-price"))*parseInt($(t).data("amount"))}),e.base={price:e.price,old:e.old},$(".set-composition_accesories .set-composition_row").each(function(a,t){$(t).find(".set-composition_checkbox input").prop("checked")&&(e.price+=parseFloat($(t).data("price"))*parseInt($(t).data("amount")),e.old+=parseFloat($(t).data("old-price"))*parseInt($(t).data("amount")))}),e}function showPrice(a){var t='<div class="price_matrix_block"><div class="price_matrix_wrapper "><div class="price" data-currency="RUB" data-value="'+a.price+'"><span><span class="values_wrapper"><span class="price_value">'+formatNumber(a.price,2)+'</span><span class="price_currency"> руб.</span></span><span class="price_measure">/шт</span></span></div>';a.price<a.old&&(t+='<div class="price discount" data-currency="RUB" data-value="'+a.old+'"><span class="values_wrapper"><span class="price_value">'+formatNumber(a.old,2)+'</span><span class="price_currency"> руб.</span></span></div>',t+='<div class="sale_block"><span class="title">Экономия&nbsp;</span><div class="text"><span class="values_wrapper" data-currency="RUB" data-value="'+(a.old-a.price)+'"><span class="price_value">'+formatNumber(a.old-a.price,2)+'</span><span class="price_currency">&nbsp;руб.</span></span></div>'),t+="</div></div>",$(".prices_block .cost.prices").html(t),$(".button_block .btn.to-cart").attr("data-value",a.price);var e,s=$(".total_summ div span");s&&(e=a.price*parseInt($(".counter_wrapp .counter_block .text").val()),s.html(formatNumber(e,0)+"&nbsp;руб."))}function formatNumber(a,t){return a.toLocaleString("ru",{minimumFractionDigits:t}).replace(",",".").replace(" ","&nbsp;")}$(document).on("click",".to-cart:not(.read_more)",function(a){a.preventDefault();var e,t,s,i,o,c,r,d,n,p,l,_,m=$(this);m.hasClass("clicked")||(m.addClass("clicked"),e=$(this).attr("data-quantity"),t=$(this).data("props"),i=s="",o="N",c={},r=$(this).data("iblockid"),d=$(this).data("offers"),p=n="",l=$(this).attr("data-item"),m.closest(".but-cell").length&&$('.counter_block[data-item="'+l+'"]').length&&(e=$('.counter_block[data-item="'+l+'"] input').val()),e=e||1,"Y"!=d?d="N":p=$(this).closest(".prices_tab").find(".bx_sku_props input").val(),t&&(s=t.split(";")),$(this).data("part_props")&&(i=$(this).data("part_props")),$(this).data("add_props")&&(o=$(this).data("add_props")),$(".rid_item").length?n=$(".rid_item").data("rid"):$(this).data("rid")&&(n=$(this).data("rid")),c=fillBasketPropsExt(m,"prop",m.data("bakset_div")),(_=calculatePrice().base.price)<=0&&(_=$(".prices_block .price:not(.discount)").data("value")),c.quantity=e,c.add_item="Y",c.rid=n,c.offers=d,c.iblockID=r,c.part_props=i,c.add_props=o,c.props=JSON.stringify(s),c.item=l,c.basket_props=p,c.price=_,"N"==m.data("empty_props")?(showBasketError($("#"+m.data("bakset_div")).html(),BX.message("ERROR_BASKET_PROP_TITLE"),"Y",m),BX.onCustomEvent("onCompleteAction",[{action:"loadForm"},m[0]])):(addItem(c,m,l),$(".set-composition_accesories .set-composition_row").each(function(a,t){$(t).find(".set-composition_checkbox input").prop("checked")&&(c.item=$(t).data("id"),c.price=$(t).data("price"),c.quantity=$(t).data("amount")*e,addItem(c,m,l))})))}),$(function(){$(".set-composition .set-composition_checkbox input").change(function(a){var t=calculatePrice();0<t.price&&showPrice(t)})});